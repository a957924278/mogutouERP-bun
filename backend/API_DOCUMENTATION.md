# è˜‘è‡å¤´ERPç³»ç»Ÿ API æ¥å£æ–‡æ¡£

## åŸºæœ¬ä¿¡æ¯

- **åŸºç¡€URL**: `http://localhost:3000`
- **æ¥å£æ ¼å¼**: JSON
- **è®¤è¯æ–¹å¼**: JWT Token

## é€šç”¨å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "data": "å“åº”æ•°æ®",
  "meta": "å…ƒæ•°æ®(åˆ†é¡µç­‰)"
}
```

### é”™è¯¯å“åº”

```json
{
  "error": "é”™è¯¯ä¿¡æ¯",
  "status": 400,
  "cause": "è¯¦ç»†é”™è¯¯åŸå› (å¯é€‰)"
}
```

## è®¤è¯è¯´æ˜

### JWT Token ä½¿ç”¨

- åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦: `Authorization: Bearer <token>`
- Token åŒ…å«ç”¨æˆ·ä¿¡æ¯: `{ id, name, tel, role }`
- è§’è‰²ç±»å‹: `admin`(ç®¡ç†å‘˜), `user`(æ™®é€šç”¨æˆ·)

### æƒé™è¯´æ˜

- ğŸ”“ æ— éœ€è®¤è¯
- ğŸ”’ éœ€è¦ç™»å½•
- ğŸ‘‘ éœ€è¦ç®¡ç†å‘˜æƒé™

---

## 1. ç”¨æˆ·è®¤è¯æ¨¡å— (Auth)

### 1.1 ç”¨æˆ·æ³¨å†Œ ğŸ”“

**POST** `/auth/register`

**è¯·æ±‚ä½“:**

```json
{
  "name": "ç”¨æˆ·å§“å",
  "tel": "13800138000",
  "password": "123456"
}
```

**å“åº”:**

```json
[
  {
    "id": "uuid",
    "name": "ç”¨æˆ·å§“å",
    "tel": "13800138000",
    "role": "user"
  }
]
```

**å­—æ®µéªŒè¯:**

- `name`: ä¸èƒ½ä¸ºç©º
- `tel`: å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ‰‹æœºå·æ ¼å¼ (1[3-9]xxxxxxxxx)
- `password`: è‡³å°‘6ä½

---

### 1.2 ç”¨æˆ·ç™»å½• ğŸ”“

**POST** `/auth/login`

**è¯·æ±‚ä½“:**

```json
{
  "tel": "13800138000",
  "password": "123456"
}
```

**å“åº”:**

```json
{
  "user": {
    "id": "uuid",
    "name": "ç”¨æˆ·å§“å",
    "tel": "13800138000",
    "role": "admin"
  },
  "token": "jwt.token.here"
}
```

---

### 1.3 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ ğŸ”’

**GET** `/auth/me`

**å“åº”:**

```json
{
  "id": "uuid",
  "name": "ç”¨æˆ·å§“å",
  "tel": "13800138000",
  "role": "admin"
}
```

---

### 1.4 ä¿®æ”¹å¯†ç  ğŸ”’

**PUT** `/auth/password`

**è¯·æ±‚ä½“:**

```json
{
  "oldPassword": "æ—§å¯†ç ",
  "newPassword": "æ–°å¯†ç "
}
```

**å“åº”:**

```json
{
  "message": "å¯†ç æ›´æ–°æˆåŠŸ"
}
```

---

### 1.5 åˆ é™¤ç”¨æˆ· ğŸ‘‘

**DELETE** `/auth/users/:id`

**å“åº”:**

```json
{
  "message": "ç”¨æˆ·åˆ é™¤æˆåŠŸ"
}
```

**æ³¨æ„:** ä¸èƒ½åˆ é™¤ç®¡ç†å‘˜ç”¨æˆ·

---

## 2. å•†å“ç®¡ç†æ¨¡å— (Commodity)

### 2.1 åˆ›å»ºå•†å“ ğŸ‘‘

**POST** `/commodities`

**è¯·æ±‚ä½“:**

```json
{
  "name": "å•†å“åç§°",
  "colour": "é¢œè‰²",
  "size": "å°ºå¯¸",
  "brand": "å“ç‰Œ",
  "number": 100,
  "presaleNumber": 0,
  "salesVolume": 0,
  "price": 99.99,
  "purchasePrice": 50.00
}
```

**å“åº”:**

```json
{
  "id": 1,
  "name": "å•†å“åç§°",
  "colour": "é¢œè‰²",
  "size": "å°ºå¯¸",
  "brand": "å“ç‰Œ",
  "number": 100,
  "presaleNumber": 0,
  "salesVolume": 0,
  "price": 99.99,
  "purchasePrice": 50.00,
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z",
  "deletedAt": null
}
```

---

### 2.2 è·å–å•†å“åˆ—è¡¨ ğŸ”’

**GET** `/commodities`

**æŸ¥è¯¢å‚æ•°:**

- `name` (å¯é€‰): å•†å“åç§°æœç´¢
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤1
- `limit` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10

**å“åº”:**

```json
{
  "data": [
    {
      "id": 1,
      "name": "å•†å“åç§°",
      "colour": "é¢œè‰²",
      "size": "å°ºå¯¸",
      "brand": "å“ç‰Œ",
      "number": 100,
      "presaleNumber": 0,
      "salesVolume": 0,
      "price": 99.99,
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "meta": {
    "total": 100,
    "page": 1,
    "limit": 10
  }
}
```

**æ³¨æ„:** æ™®é€šç”¨æˆ·çœ‹ä¸åˆ°é‡‡è´­ä»·æ ¼(`purchasePrice`)

---

### 2.3 ç®¡ç†å‘˜è·å–å•†å“åˆ—è¡¨ ğŸ‘‘

**GET** `/commodities/admin`

**æŸ¥è¯¢å‚æ•°:** åŒ2.2

**å“åº”:** åŒ…å«æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬`purchasePrice`

---

### 2.4 è·å–å•ä¸ªå•†å“ ğŸ”’

**GET** `/commodities/:id`

**å“åº”:**

```json
{
  "id": 1,
  "name": "å•†å“åç§°",
  "colour": "é¢œè‰²",
  "size": "å°ºå¯¸",
  "brand": "å“ç‰Œ",
  "number": 100,
  "presaleNumber": 0,
  "salesVolume": 0,
  "price": 99.99,
  "purchasePrice": 50.00,
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z",
  "deletedAt": null
}
```

---

### 2.5 æ›´æ–°å•†å“ ğŸ‘‘

**PUT** `/commodities/:id`

**è¯·æ±‚ä½“:** (æ‰€æœ‰å­—æ®µå¯é€‰)

```json
{
  "name": "æ–°å•†å“åç§°",
  "price": 109.99
}
```

**å“åº”:** æ›´æ–°åçš„å•†å“ä¿¡æ¯

---

### 2.6 åˆ é™¤å•†å“ ğŸ‘‘

**DELETE** `/commodities/:id`

**å“åº”:**

```json
{
  "message": "å•†å“åˆ é™¤æˆåŠŸ"
}
```

---

## 3. å®¢æˆ·è®¢å•æ¨¡å— (Customer Order)

### 3.1 åˆ›å»ºå®¢æˆ·è®¢å• ğŸ‘‘

**POST** `/customer-orders`

**è¯·æ±‚ä½“:**

```json
{
  "remarks": "è®¢å•å¤‡æ³¨(å¯é€‰)",
  "amount": 299.99,
  "name": "å®¢æˆ·å§“å",
  "tel": "13800138000",
  "deliveryAddress": "é€è´§åœ°å€",
  "deliveryTime": "2024-01-01 10:00",
  "deposit": 100.00,
  "goods": [
    {
      "id": "1",
      "number": 2
    },
    {
      "id": "3",
      "number": 1
    }
  ]
}
```

**å“åº”:**

```json
{
  "id": 1,
  "operator": "æ“ä½œå‘˜ID",
  "customerName": "å®¢æˆ·å§“å",
  "customerTel": "13800138000",
  "deliveryAddress": "é€è´§åœ°å€",
  "deliveryTime": "2024-01-01 10:00",
  "amount": 299.99,
  "deposit": 100.00,
  "remarks": "è®¢å•å¤‡æ³¨",
  "state": "æœªå®Œæˆ",
  "freight": 0,
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z",
  "deletedAt": null
}
```

**å­—æ®µè¯´æ˜:**

- åˆ›å»ºè®¢å•æ—¶ä¼šè‡ªåŠ¨å¢åŠ å•†å“çš„é¢„å”®æ•°é‡
- è®¢å•çŠ¶æ€é»˜è®¤ä¸º"æœªå®Œæˆ"
- è¿è´¹åœ¨ç¡®è®¤æ—¶è®¾å®š

---

### 3.2 è·å–å®¢æˆ·è®¢å•åˆ—è¡¨ ğŸ‘‘

**GET** `/customer-orders`

**æŸ¥è¯¢å‚æ•°:**

- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤1
- `limit` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10

**å“åº”:**

```json
{
  "data": [
    {
      "id": 1,
      "operator": "æ“ä½œå‘˜ID",
      "operatorName": "æ“ä½œå‘˜å§“å",
      "customerName": "å®¢æˆ·å§“å",
      "customerTel": "13800138000",
      "deliveryAddress": "é€è´§åœ°å€",
      "deliveryTime": "2024-01-01 10:00",
      "amount": 299.99,
      "deposit": 100.00,
      "remarks": "è®¢å•å¤‡æ³¨",
      "state": "æœªå®Œæˆ",
      "freight": 0,
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z",
      "goods": [
        {
          "id": 1,
          "name": "å•†å“åç§°",
          "colour": "é¢œè‰²",
          "size": "å°ºå¯¸",
          "brand": "å“ç‰Œ",
          "price": 99.99,
          "number": 2
        }
      ]
    }
  ],
  "meta": {
    "total": 50,
    "page": 1,
    "limit": 10
  }
}
```

---

### 3.3 ç¡®è®¤å®¢æˆ·è®¢å• ğŸ‘‘

**PUT** `/customer-orders/:id/confirm`

**è¯·æ±‚ä½“:**

```json
{
  "freight": 20.00
}
```

**å“åº”:** æ›´æ–°åçš„è®¢å•ä¿¡æ¯

**æ“ä½œè¯´æ˜:**

- æ£€æŸ¥å•†å“åº“å­˜æ˜¯å¦å……è¶³
- å‡å°‘å•†å“åº“å­˜æ•°é‡å’Œé¢„å”®æ•°é‡
- å¢åŠ å•†å“é”€é‡
- æ›´æ–°è®¢å•çŠ¶æ€ä¸º"å·²å®Œæˆ"
- åªæœ‰è®¢å•åˆ›å»ºè€…å¯ä»¥ç¡®è®¤

---

### 3.4 åˆ é™¤å®¢æˆ·è®¢å• ğŸ‘‘

**DELETE** `/customer-orders/:id`

**å“åº”:**

```json
{
  "message": "è®¢å•åˆ é™¤æˆåŠŸ"
}
```

**æ“ä½œè¯´æ˜:**

- æ¢å¤å•†å“é¢„å”®æ•°é‡
- å·²ç¡®è®¤è®¢å•æ— æ³•åˆ é™¤
- åªæœ‰è®¢å•åˆ›å»ºè€…å¯ä»¥åˆ é™¤

---

## 4. é‡‡è´­è®¢å•æ¨¡å— (Purchase Order)

### 4.1 åˆ›å»ºé‡‡è´­è®¢å• ğŸ‘‘

**POST** `/purchase-orders`

**è¯·æ±‚ä½“:**

```json
{
  "remarks": "é‡‡è´­å¤‡æ³¨(å¯é€‰)",
  "amount": 1000.00,
  "freight": 50.00,
  "goods": [
    {
      "id": "1",
      "number": 20
    },
    {
      "id": "2",
      "number": 10
    }
  ]
}
```

**å“åº”:**

```json
{
  "id": 1,
  "operator": "æ“ä½œå‘˜ID",
  "remarks": "é‡‡è´­å¤‡æ³¨",
  "amount": 1000.00,
  "freight": 50.00,
  "state": "æœªå®Œæˆ",
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z",
  "deletedAt": null
}
```

---

### 4.2 è·å–é‡‡è´­è®¢å•åˆ—è¡¨ ğŸ‘‘

**GET** `/purchase-orders`

**æŸ¥è¯¢å‚æ•°:**

- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤1
- `limit` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10

**å“åº”:**

```json
{
  "data": [
    {
      "id": 1,
      "operator": "æ“ä½œå‘˜ID",
      "operatorName": "æ“ä½œå‘˜å§“å",
      "remarks": "é‡‡è´­å¤‡æ³¨",
      "amount": 1000.00,
      "freight": 50.00,
      "state": "æœªå®Œæˆ",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z",
      "goods": [
        {
          "id": 1,
          "name": "å•†å“åç§°",
          "colour": "é¢œè‰²",
          "size": "å°ºå¯¸",
          "brand": "å“ç‰Œ",
          "price": 99.99,
          "purchasePrice": 50.00,
          "number": 20
        }
      ]
    }
  ],
  "meta": {
    "total": 25,
    "page": 1,
    "limit": 10
  }
}
```

---

### 4.3 ç¡®è®¤é‡‡è´­è®¢å• ğŸ‘‘

**PUT** `/purchase-orders/:id/confirm`

**è¯·æ±‚ä½“:**

```json
{
  "freight": 60.00
}
```

**å“åº”:** æ›´æ–°åçš„è®¢å•ä¿¡æ¯

**æ“ä½œè¯´æ˜:**

- å¢åŠ å•†å“åº“å­˜æ•°é‡
- æ›´æ–°è®¢å•çŠ¶æ€ä¸º"å·²å®Œæˆ"
- åªæœ‰è®¢å•åˆ›å»ºè€…å¯ä»¥ç¡®è®¤

---

### 4.4 åˆ é™¤é‡‡è´­è®¢å• ğŸ‘‘

**DELETE** `/purchase-orders/:id`

**å“åº”:**

```json
{
  "message": "é‡‡è´­è®¢å•åˆ é™¤æˆåŠŸ"
}
```

**æ“ä½œè¯´æ˜:**

- å·²ç¡®è®¤è®¢å•æ— æ³•åˆ é™¤
- åªæœ‰è®¢å•åˆ›å»ºè€…å¯ä»¥åˆ é™¤

---

## 5. å…¶ä»–æ¥å£

### 5.1 å¥åº·æ£€æŸ¥ ğŸ”“

**GET** `/health`

**å“åº”:** `OK`

---

### 5.2 é¦–é¡µ ğŸ”“

**GET** `/`

**å“åº”:** `mogutouERP Backend is running!`

---

### 5.3 å—ä¿æŠ¤æ•°æ®ç¤ºä¾‹ ğŸ”’

**GET** `/protected-data`

**å“åº”:**

```json
{
  "message": "æ‚¨å·²æˆåŠŸè®¿é—®å—ä¿æŠ¤çš„æ•°æ®ï¼",
  "user": {
    "id": "uuid",
    "name": "ç”¨æˆ·å§“å",
    "tel": "13800138000",
    "role": "admin"
  }
}
```

---

## 6. é”™è¯¯ç è¯´æ˜

| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 200 | è¯·æ±‚æˆåŠŸ |
| 201 | åˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªæˆæƒ/ç™»å½•å¤±æ•ˆ |
| 403 | æƒé™ä¸è¶³ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## 7. ä¸šåŠ¡è§„åˆ™è¯´æ˜

### ç”¨æˆ·è§’è‰²

- `admin`: ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™
- `user`: æ™®é€šç”¨æˆ·ï¼Œæƒé™å—é™

### è®¢å•çŠ¶æ€

- `æœªå®Œæˆ`: è®¢å•å·²åˆ›å»ºï¼Œæœªç¡®è®¤
- `å·²å®Œæˆ`: è®¢å•å·²ç¡®è®¤ï¼Œåº“å­˜å·²æ›´æ–°

### å•†å“åº“å­˜ç®¡ç†

- `number`: å®é™…åº“å­˜æ•°é‡
- `presaleNumber`: é¢„å”®æ•°é‡ï¼ˆå·²ä¸‹å•ä½†æœªç¡®è®¤ï¼‰
- `salesVolume`: ç´¯è®¡é”€é‡

### æƒé™æ§åˆ¶

- åªæœ‰è®¢å•åˆ›å»ºè€…å¯ä»¥ç¡®è®¤/åˆ é™¤è‡ªå·±çš„è®¢å•
- ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹é‡‡è´­ä»·æ ¼ï¼Œæ™®é€šç”¨æˆ·ä¸èƒ½
- æ‰€æœ‰è®¢å•ç›¸å…³æ“ä½œéœ€è¦ç®¡ç†å‘˜æƒé™

---

## 8. å¼€å‘ç¯å¢ƒ

- **æ¡†æ¶**: Hono.js
- **æ•°æ®åº“**: SQLite + Drizzle ORM
- **è®¤è¯**: JWT
- **è¿è¡Œæ—¶**: Bun
- **ç«¯å£**: 3000
